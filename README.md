# ECサイトバックエンドAPI (クリーンアーキテクチャ実装)

## 概要

このプロジェクトは、Vibe-Coding実験の**グループ B (With-Arch)** として、クリーンアーキテクチャの原則に基づいて実装されたECサイトバックエンドAPIです。

## アーキテクチャ

### レイヤー構造

```
.
├── domain/              # ドメイン層 (エンティティ、リポジトリインターフェース、ドメインサービス)
│   ├── entity/         # エンティティ定義
│   ├── repository/     # リポジトリインターフェース
│   └── service/        # ドメインサービス
├── usecase/            # ユースケース層 (ビジネスロジック)
│   ├── interactor/     # ユースケース実装
│   └── port/          # ポート（外部サービスインターフェース）
├── infrastructure/     # インフラストラクチャ層 (具体的な実装)
│   ├── persistence/    # データ永続化実装
│   └── auth/          # 認証サービス実装
├── interface/          # インターフェース層 (外部との接点)
│   ├── handler/       # HTTPハンドラー
│   ├── middleware/    # ミドルウェア
│   └── router/        # ルーティング設定
├── di/                 # 依存性注入コンテナ
└── main.go            # アプリケーションエントリーポイント
```

### 依存関係の方向

- `domain` → なし（最も内側の層）
- `usecase` → `domain`
- `infrastructure` → `domain`, `usecase`
- `interface` → `usecase`
- `di`, `main` → すべての層

## 機能

### エンティティ
- **Product**: 商品（ID、名前、価格、在庫数、カテゴリ）
- **User**: ユーザー（ID、ユーザー名、パスワードハッシュ、管理者フラグ）
- **Order**: 注文（ID、ユーザーID、注文明細、合計金額、ステータス）

### API エンドポイント

#### 公開エンドポイント
- `POST /api/v1/register` - ユーザー登録
- `POST /api/v1/login` - ログイン
- `GET /api/v1/products` - 商品一覧取得
- `GET /api/v1/products/:id` - 商品詳細取得

#### 認証必須エンドポイント
- `GET /api/v1/users/:id` - ユーザープロフィール取得
- `POST /api/v1/orders` - 注文作成
- `GET /api/v1/orders` - ユーザーの注文一覧取得
- `GET /api/v1/orders/:id` - 注文詳細取得

#### 管理者限定エンドポイント
- `POST /api/v1/products` - 商品作成

## ビジネスロジック

1. **アトミックな注文処理**: 注文確定時、在庫チェックと在庫削減を同時に実行
2. **商品フィルタリング**: カテゴリによる商品一覧のフィルタリング
3. **管理者認可**: 商品作成は管理者のみ実行可能

## 起動方法

### 必要な環境
- Go 1.19以上

### インストールと起動

```bash
# 依存関係のインストール
go mod download

# アプリケーション起動
go run main.go

# または
go build -o server
./server
```

### テスト実行

```bash
# ユニットテスト
go test ./...

# APIテスト（サーバー起動後）
./test_api.sh
```

## テストアカウント

サーバー起動時に以下のテストアカウントが自動作成されます：

- **管理者**: username=`admin`, password=`admin123`
- **一般ユーザー**: username=`user`, password=`user123`

## 実装の特徴

### クリーンアーキテクチャの適用

1. **依存性の逆転**: 内側の層は外側の層に依存しない
2. **ビジネスロジックの分離**: ドメインロジックとユースケースを明確に分離
3. **テスタビリティ**: インターフェースを通じた依存性注入により高いテスタビリティを実現
4. **柔軟性**: インフラストラクチャ層の実装を容易に置き換え可能

### ドメイン駆動設計の要素

- エンティティにビジネスロジックをカプセル化
- ドメインサービスで複雑なビジネスルールを実装
- リポジトリパターンによるデータアクセスの抽象化

## ファイル数とコード行数

- 総ファイル数: 約20ファイル
- 主要コード行数: 約2000行

このアーキテクチャにより、保守性、拡張性、テスタビリティの高いシステムを実現しています。